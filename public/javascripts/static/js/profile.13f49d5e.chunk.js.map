{"version":3,"sources":["common/content/table/Columns.js","common/content/Selection.js","common/content/Readme.jsx","common/StoredUIState.js","profile/API.js","common/content/activity/ActivityWidget.jsx","profile/sidebar/Sidebar.jsx","profile/top/Search.jsx","profile/top/TopBar.jsx","profile/App.jsx","common/content/upload/DropzoneDecoration.jsx","common/content/profile/Avatar.jsx","common/content/HeaderIcon.jsx","common/content/Breadcrumbs.jsx","common/content/profile/CollaboratorList.jsx","common/content/profile/ProfileInfo.jsx","common/content/table/rows/BaseRowComponent.jsx","common/content/table/rows/HeaderRow.jsx","common/content/table/rows/DocumentRow.jsx","common/content/table/rows/FolderRow.jsx","common/components/Modal.jsx","common/content/table/preferences/ColumnOrder.jsx","common/content/table/preferences/PreferencesModal.jsx","common/content/table/TablePane.jsx","common/content/grid/Folder.jsx","common/content/grid/Document.jsx","common/content/grid/GridPane.jsx"],"names":["COLUMNS","HEADER_NAMES","author","title","language","date_freeform","uploaded_at","last_edit_at","last_edit_by","annotations","public_visibility","status_ratio","activity","owner","shared_by","access_level","COLUMN_WIDTH","agg_document","AGGREGATE_COLUMNS","Columns","Object","_home_simonr_Workspaces_pelagios_recogito2_workspace_frontend_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","_home_simonr_Workspaces_pelagios_recogito2_workspace_frontend_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__","key","value","field","w","columns","reduce","result","startsWith","concat","push","Selection","allItems","selection","_allItems","_selection","length","item","isCtrlPressed","thisIdx","indexOf","splice","toIdx","_this","selectedIndices","map","minIdx","Math","min","apply","maxIdx","max","isOutside","slice","from","to","Readme","react__WEBPACK_IMPORTED_MODULE_5___default","a","createElement","className","props","children","Component","StoredUIState","state","localStorage","getItem","JSON","parse","prefixed","setItem","stringify","API","axios","get","username","config","post","LINE_STYLE","stroke","strokeWidth","AXIS_STYLE","fontSize","color","tickFormatter","tick","Intl","DateTimeFormat","month","format","Date","ActivityWidget","n","toTimestamp","empty","Array","fill","arr","_","last","reverse","timestamp","t","toTime","getTime","createEmptySeries","timeseries","stats","over_time","date","padTimeseries","react_default","number_format_default","displayType","total_contributions","thousandSeparator","BarChart","width","height","barCategoryGap","data","computeChart","CartesianGrid","strokeDasharray","horizontal","XAxis","type","dataKey","axisLine","tickSize","tickCount","tickLine","domain","padding","left","right","Bar","Sidebar","ProfileInfo","account","ActivityWidget_ActivityWidget","CollaboratorList","Search","placeholder","TopBar","href","name","me","real_name","Fragment","src","alt","logged_in","Search_Search","loggedInAs","notLoggedIn","App","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","visitedAccount","presentation","table_columns","table_sorting","busy","documents","assign","load","_profileOwner","window","location","pathname","substring","_this2","fetchPublicAccountInfo","then","r","setState","fetchLoginStatus","reloadDocuments","_this3","fetchAccessibleDocuments","getDisplayConfig","items","expandAggregatedColumns","sort","before","p","save","_this4","sorting","_this5","TopBar_TopBar","Sidebar_Sidebar","Breadcrumbs","label","HeaderIcon","icon","onClick","onTogglePresentation","bind","TablePane","folders","disableFiledrop","onSort","onSortTable","onChangeColumnPrefs","GridPane","ReactDOM","render","App_App","document","getElementById","AnimatedDiv","posed","div","open","bottom","transition","ease","duration","closed","DropzoneDecoration","_home_simonr_Workspaces_pelagios_recogito2_workspace_frontend_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_home_simonr_Workspaces_pelagios_recogito2_workspace_frontend_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","visible","pose","Avatar","str","hash","i","charCodeAt","stringToHslColor","style","backgroundColor","charAt","toUpperCase","link","VIEW_LABELS","MY_DOCUMENTS","SHARED_WITH_ME","view","collaborators","fetchCollaborators","user","_Avatar_jsx__WEBPACK_IMPORTED_MODULE_7__","Identity","url","replace","dataAvailable","member_since","_Avatar_jsx__WEBPACK_IMPORTED_MODULE_6__","year","day","bio","website","formatURL","BaseRowComponent","updateTotalRowSpan","next","_totalSpan","total","getSpan","HeaderRow","prototype","sortColumn","sortAsc","ICONS","TEXT_PLAIN","TEXT_TEIXML","IMAGE_UPLOAD","IMAGE_IIIF","DATA_CSV","FORMATTERS","datetime","lib_default","visibility","AGGREGATE_FIELDS","DocumentRow","formatter","undefined","filetypes","id","selected","createAggregateField","createField","FolderRow","Modal","react_draggable_default","handle","onClose","SortableItem","SortableElement","_ref","SortableList","SortableContainer","_ref2","idx","index","ColumnOrder","onSortEnd","e","oldIndex","newIndex","PreferencesModal","states","forEach","isChecked","includes","checked","toAppend","filter","checkAll","setAllRows","prev","arrayMove","Modal_Modal","onCancel","onClickAll","onChange","toggleOne","htmlFor","ColumnOrder_ColumnOrder","onSave","prefsOpen","evt","isShift","getModifierState","isCtrl","selectRange","selectItem","onSelect","getSelectedItems","preventDefault","args","FolderRow_FolderRow","DocumentRow_DocumentRow","asc","by","active","drag","files","dataTransfer","getData","hostname","onDropFiles","onDropURL","readme","React","Children","toArray","c","shift","tablePane","es","rowCount","rowHeight","rowRenderer","HeaderRow_HeaderRow","sortBy","showPreferences","dist_es","disableClick","onDragEnter","onDrag","onDragLeave","onDrop","PreferencesModal_PreferencesModal","onSavePreferences","Folder","Document","isStacked","fileCount","onDoubleClick","itemsPerRow","fromIndex","itemsInRow","renderedItems","rowIdx","Folder_Folder","Document_Document","file_count","gridPane","itemCount","floor","ceil"],"mappings":"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","file":"static/js/profile.13f49d5e.chunk.js","sourcesContent":["export const COLUMNS = [\n  // Aggregate fields\n  // 'agg_document',\n\n  // Common fields\n  'author',\n  'title',\n  'language',\n  'date_freeform',\n  'uploaded_at',\n  'last_edit_at',\n  'last_edit_by',\n  'annotations',\n  'public_visibility',\n  // 'status_ratio',\n  // 'activity',\n\n  // Shared with me\n  // 'owner',\n  // 'shared_by',\n  // 'access_level'\n]\n\n// Labels to use for fields\nexport const HEADER_NAMES = {\n  // agg_document    : 'Document',\n\n  author            : 'Author',\n  title             : 'Title',\n  language          : 'Language',\n  date_freeform     : 'Date',\n  uploaded_at       : 'Uploaded at',\n  last_edit_at      : 'Last edit',\n  last_edit_by      : 'Last edit by',\n  annotations       : 'Annotations',\n  public_visibility : 'Visibility',\n  status_ratio      : 'Verification ratio',\n  activity          : 'Activity graph',\n\n  owner             : 'Document owner',\n  shared_by         : 'Shared by',\n  access_level      : 'Access level'\n}\n\n// Relative width requirements per column (XL, L, M, S)\nexport const COLUMN_WIDTH = {\n  agg_document    : 'XL',\n\n  author            : 'M',\n  title             : 'L',\n  language          : 'M',\n  date_freeform     : 'M',\n  uploaded_at       : 'M',\n  last_edit_at      : 'M',\n  last_edit_by      : 'M',\n  annotations       : 'M',\n  public_visibility : 'M',\n  status_ratio      : 'M',\n  activity          : 'M',\n\n  owner             : 'M',\n  shared_by         : 'M',\n  access_level      : 'S'\n}\n\nexport const AGGREGATE_COLUMNS = {\n  agg_document: [ 'author', 'document' ]\n}\n\n// Static helper methods \nexport class Columns {\n\n  static getSpan(field) {\n    const w = COLUMN_WIDTH[field];\n    if (w === 'XL') \n      return 6;\n    else if (w === 'L')\n      return 4;\n    else if (w === 'M')\n      return 2;\n    else if (w === 'S')\n      return 1;\n  }\n\n  /** Expands agg_ columns to those that are required to build them **/\n  static expandAggregatedColumns(columns) {\n    return columns.reduce((result, field) => {\n      if (field.startsWith('agg_'))\n        result = result.concat(AGGREGATE_COLUMNS[field]);\n      else\n        // Just append\n        result.push(field);\n\n      return result;\n    }, []);\n  }\n\n}","export default class Selection {\n    \n  constructor(allItems, selection) {\n    this._allItems = allItems;\n    this._selection = selection;\n  }\n\n  clear() {\n    this._selection = [];\n  }\n\n  isEmpty() {\n    return this._selection.length === 0;\n  }\n\n  getSelectedItems() {\n    return this._selection;\n  }\n\n  selectItem(item, isCtrlPressed) {\n    const thisIdx = this._selection.indexOf(item);\n    const isSelected = thisIdx > -1;\n\n    if (isCtrlPressed) {\n      // Toggle this item, leave the rest of the selection unchanged\n      if (isSelected)\n        this._selection.splice(thisIdx, 1);\n      else\n        this._selection.push(item);      \n    } else {\n      // Toggle state of this item and clear the rest of the selection\n      this._selection = [ item ];\n    }\n  }\n\n  /**\n   * Range selection: SHIFT + click. \n   * \n   * Behavior follows Mac conventions, cf. \n   * https://stackoverflow.com/questions/2959887/algorithm-for-shift-clicking-items-in-a-collection-to-select-them\n   */\n  selectRange(toIdx) {\n    const selectedIndices = this._selection.map(item => {\n      return this._allItems.indexOf(item);\n    });   \n    \n    const minIdx = Math.min.apply(null, selectedIndices);\n    const maxIdx = Math.max.apply(null, selectedIndices);\n\n    const isOutside = (toIdx > maxIdx) || (toIdx < minIdx);\n\n    const slice = (from, to) => this._allItems.slice(from, to + 1);\n\n    if (isOutside && toIdx > maxIdx)\n      // Expand selection downwards\n      this._selection = slice(minIdx, toIdx);\n    else if (isOutside)\n      // Expand selection upwards\n      this._selection = slice(toIdx, maxIdx);\n    else\n      // Fill from topmost\n      this._selection = slice(minIdx, toIdx);\n  }\n\n}","import React, { Component } from 'react';\n\nexport default class Readme extends Component {\n\n  render() {\n    return (\n      <div className=\"readme\">\n        <div className=\"inner\">\n          {this.props.children}\n        </div>\n      </div>\n    )\n  }\n\n}\n","export default class StoredUIState {\n\n  static load() {\n    const state = {};\n\n    const addIfDefined = (key) => {\n      const value = localStorage.getItem(`r2.workspace.${key}`);\n      if (value) state[key] = JSON.parse(value);\n    }\n\n    ['view', 'presentation', 'table_columns', 'table_sorting'].map(addIfDefined)\n\n    return state;\n  }\n\n  static save(key, value) {\n    const prefixed = `r2.workspace.${key}`\n    localStorage.setItem(prefixed, JSON.stringify(value));\n  }\n\n}","import axios from 'axios';\n\nexport default class API {\n\n  static fetchLoginStatus() {\n    return axios.get('/api/me');\n  }\n\n  static fetchPublicAccountInfo(username) {\n    return axios.get(`/api/account/${username}`);\n  }\n\n  static fetchAccessibleDocuments(owner, config) {\n    return axios.post(`/api/documents/accessible/${owner}`, config);\n  }\n\n}","import React, { Component } from 'react';\nimport { Bar, BarChart, CartesianGrid, XAxis } from 'recharts';\nimport NumberFormat from 'react-number-format';\n\nconst LINE_STYLE = {\n  stroke: '#c2c2c2', \n  strokeWidth:1\n}\n\nconst AXIS_STYLE = {\n  fontSize:\"12px\",\n  color:\"#3f3f3f\"\n}\n\nconst WEEK = 3600000 * 24 * 7; // A week in milliseconds\n\nconst tickFormatter = (tick) => new Intl.DateTimeFormat('en-GB', {\n  month: 'short'\n}).format(new Date(tick));\n\nexport default class ActivityWidget extends Component {\n\n  /** Helper that generates an empty time series of N buckets with value 0 */\n  createEmptySeries(n, toTimestamp) {\n    const empty = new Array(n);\n    empty.fill(0); // Needs to contain *something* for .reduce to work\n\n    const timestamps = empty.reduce((arr, _) => {\n      const last = arr[arr.length - 1];\n      arr.push(last - WEEK);\n      return arr;\n    }, [ toTimestamp - WEEK ]).reverse();\n\n    return timestamps.map(timestamp => {\n      return { timestamp: timestamp, value: 0 };\n    });\n  }\n\n  padTimeseries(t) {\n    const toTime = t.length > 0 ? t[0].timestamp : new Date().getTime();\n    const padding = this.createEmptySeries(19 - t.length, toTime);\n    return padding.concat(t);\n  }\n\n  computeChart() {\n    // Data comes as ISO strings - convert\n    const timeseries = this.props.stats.over_time.map(t => {\n      return { timestamp: Date.parse(t.date), value: t.value };\n    });\n\n    if (timeseries.length < 20) {\n      return this.padTimeseries(timeseries);\n    } else {\n      return timeseries;\n    }\n  }\n\n  render() {\n    return (\n      <div className={this.props.className ? \n        `activity-widget ${this.props.className}` : \"activity-widget\"}>\n\n        <h2>Activity \n          {this.props.stats && \n            <span className=\"count\">\n              <NumberFormat \n                displayType=\"text\"\n                value={this.props.stats.total_contributions}\n                thousandSeparator={true} /> edits\n            </span>\n          }\n        </h2>\n\n        {this.props.stats &&\n          <BarChart \n            width={this.props.width} \n            height={this.props.height} \n            barCategoryGap={1.5}\n            data={this.computeChart()} >\n\n            <CartesianGrid \n              strokeDasharray=\"3\" \n              horizontal={false}/>\n\n            <XAxis \n              type=\"number\"\n              dataKey=\"timestamp\"\n\n              axisLine={LINE_STYLE} \n\n              tick={AXIS_STYLE}\n              tickSize={4}\n              tickCount={6}\n              tickLine={LINE_STYLE}\n              tickFormatter={tickFormatter}\n\n              height={20}\n              domain={['dataMin', 'dataMax']}\n              padding={{ left: 5, right: 5 }} />\n\n            <Bar \n              dataKey=\"value\" \n              fill={this.props.fill} />\n\n          </BarChart>\n        }\n      </div>\n    )\n  }\n\n}","import React, { Component } from 'react';\n\nimport ActivityWidget from '../../common/content/activity/ActivityWidget.jsx';\nimport CollaboratorList from '../../common/content/profile/CollaboratorList.jsx';\nimport ProfileInfo from '../../common/content/profile/ProfileInfo.jsx';\n\nexport default class Sidebar extends Component {\n\n  render() {\n    return (\n      <div className=\"sidebar\">\n        <div className=\"section\">\n          <ProfileInfo account={this.props.account} />\n        </div>\n\n        <ActivityWidget \n          className=\"section\" \n          width={237}\n          height={55}\n          fill=\"#4483c4\"\n          stats={this.props.account && this.props.account.stats} />\n\n        <CollaboratorList \n          className=\"section\"\n          title=\"Top collaborators\"\n          username={this.props.account && this.props.account.username} />\n      </div>\n    );\n  }\n\n}","import React, { Component } from 'react';\n\nexport default class Search extends Component {\n\n  render() {\n    return (\n      <div className=\"search\">\n        <div className=\"wrapper\">\n          <input placeholder=\"Search Recogito...\"/>\n        </div>\n        <span className=\"icon hand-lens\">&#xf002;</span>\n      </div>\n    )\n  }\n\n}","import React, { Component } from 'react';\n\nimport Search from './Search.jsx';\n\nexport default class TopBar extends Component {\n\n  notLoggedIn() {\n    return (\n      <div className=\"not logged-in\">\n        <a href=\"/login\">Log in</a>&nbsp; | &nbsp;New to Recogito? &nbsp;<a href=\"/\">Learn more</a>\n      </div>\n    )\n  }\n\n  loggedInAs() {\n    const name = this.props.me.real_name ? this.props.me.real_name : this.props.me.username;\n\n    return (\n      <div className=\"logged-in\">\n        Logged in as <a href={`/${this.props.me.username}`}>{name}</a>\n      </div>\n    )\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        <div className=\"top-bar\">\n          <div className=\"top-left\">\n            <a href=\"/my\" className=\"home\">\n              <img src=\"/assets/images/logo-recogito-small.png\" alt=\"Recogito logo\" />\n            </a>\n            { this.props.me && this.props.me.logged_in && <a href=\"/my\">My Workspace</a> }\n            <a href=\"/help\">Help</a>\n            <a href=\"/help/about\">About</a>\n\n            <Search></Search>\n          </div>\n\n          <div className=\"top-right\">\n            {this.props.me && \n              this.props.me.logged_in ? this.loggedInAs() : this.notLoggedIn()\n            }\n          </div>\n        </div>\n      </React.Fragment>\n    );\n  }\n\n}","import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport API from './API.js';\n\nimport GridPane from '../common/content/grid/GridPane.jsx';\nimport TablePane from '../common/content/table/TablePane.jsx';\nimport Breadcrumbs from '../common/content/Breadcrumbs.jsx';\nimport HeaderIcon from '../common/content/HeaderIcon.jsx';\nimport StoredUIState from '../common/StoredUIState.js';\nimport Sidebar from './sidebar/Sidebar.jsx';\nimport TopBar from './top/TopBar.jsx';\nimport { Columns } from '../common/content/table/Columns.js';\n\n\nimport '../../assets/style/profile/index.scss';\n\nexport default class App extends Component {\n\n  constructor(props) {\n    super(props);\n\n    const state = {\n      me             : null, // Login identity\n      visitedAccount : null,\n      presentation   : 'TABLE',\n      table_columns  : [\n        \"author\",\n        \"title\",\n        \"language\",\n        \"date_freeform\",\n        \"uploaded_at\",\n        \"last_edit_at\"\n      ],\n      table_sorting  : null,\n      busy           : false,\n      documents      : null // Can be null (not loaded yet) or [] (no shared documents)\n    }\n\n    Object.assign(state, StoredUIState.load());\n    this.state = state;\n\n    this._profileOwner = (process.env.NODE_ENV === 'development') ? 'rainer' : window.location.pathname.substring(1);\n  }\n\n  componentDidMount() {\n    API\n      .fetchPublicAccountInfo(this._profileOwner)\n      .then(r => this.setState({ visitedAccount: r.data }));\n\n    API\n      .fetchLoginStatus()\n      .then(r => this.setState({ me: r.data })); \n\n    this.reloadDocuments();\n  }\n\n  reloadDocuments() {\n    API\n      .fetchAccessibleDocuments(this._profileOwner, this.getDisplayConfig())\n      .then(r => this.setState({ documents: r.data.items }));\n  }\n\n  getDisplayConfig() {\n    if (this.state.presentation === 'GRID')\n      return; // No configs for grid view\n\n    return {\n      columns: Columns.expandAggregatedColumns(this.state.table_columns),\n      sort: this.state.table_sorting\n    };\n  }\n\n  onTogglePresentation(presentation) {\n    this.setState(before => { \n      const p = (before.presentation === 'TABLE') ? 'GRID' : 'TABLE';\n      StoredUIState.save('presentation', p);\n      return { presentation: p };\n    });\n  }\n\n  onChangeColumnPrefs(columns) {\n    StoredUIState.save('table_columns', columns);\n    this.setState({ table_columns: columns }, () => {\n      this.reloadDocuments();\n    });\n  }\n  \n  onSortTable(sorting) {\n    StoredUIState.save('table_sorting', sorting);\n    this.setState({ table_sorting: sorting }, () => {\n      this.reloadDocuments();\n    });\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        <TopBar \n          me={this.state.me} />\n\n        <Sidebar \n          account={this.state.visitedAccount}/>\n\n        <div className=\"container\">\n          <Breadcrumbs label=\"Public Documents\" />\n\n          <HeaderIcon\n            className=\"presentation-toggle stroke7\"\n            icon={(this.state.presentation === 'TABLE') ? '\\ue645' : '\\ue636'} \n            onClick={this.onTogglePresentation.bind(this)} />\n\n          {this.state.documents && this.state.visitedAccount && (\n              \n              this.state.documents.length === 0 ? \n                <div className=\"no-public-documents\">\n                  {this.state.visitedAccount.username} has not shared any documents yet\n                </div> :\n\n                this.state.presentation === 'TABLE' ?\n                  <TablePane\n                    folders={[]}\n                    documents={this.state.documents}\n                    columns={this.state.table_columns}\n                    sorting={this.state.table_sorting}\n                    busy={this.state.busy} \n                    disableFiledrop={true} \n                    onSort={this.onSortTable.bind(this)} \n                    onChangeColumnPrefs={this.onChangeColumnPrefs.bind(this)} /> \n                  :\n                  <GridPane\n                    folders={[]}\n                    documents={this.state.documents}\n                    busy={this.state.busy} \n                    disableFiledrop={true} />\n          )}\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nReactDOM.render(<App />, document.getElementById('app'));\n","import React, { Component } from 'react';\nimport posed from 'react-pose';\n\nconst AnimatedDiv = posed.div({\n  open:   { \n    bottom: '30px',\n    transition: {\n      ease: 'easeOut',\n      duration:200\n    }\n  },\n  closed: { bottom: '-140px' }\n});\n\nexport default class DropzoneDecoration extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = { visible: false };\n  }\n\n  componentDidMount() {\n    this.setState({ visible: true });\n  }\n\n  render() {\n    return (\n      <div className=\"dropzone-decoration\">\n        <AnimatedDiv className=\"inner\" pose={this.state.visible ? 'open' : 'closed'}>\n          <span className=\"icon\">&#xf0ee;</span>\n          <p className=\"instructions\">\n            Drop files or IIIF manifest URLs to add them to your workspace.\n          </p>\n          <p className=\"supported\">\n            Supported formats: plain text (UTF-8), TEI/XML, image files, CSV (UTF-8)\n          </p>\n        </AnimatedDiv>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nexport default class Avatar extends Component {\n\n  // https://medium.com/@pppped/compute-an-arbitrary-color-for-user-avatar-starting-from-his-username-with-javascript-cd0675943b66\n  stringToHslColor(str) {\n    let hash = 0;\n    for (let i=0; i<str.length; i++) {\n      hash = str.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    return hash % 360;\n  }\n\n  render() {\n    const color = this.props.username ? `hsl(${this.stringToHslColor(this.props.username)}, 35%, 65%)` : '#e2e2e2';\n\n    return (\n      <div className=\"avatar\" style={{ backgroundColor: color }}>\n        <div className=\"inner\">\n          { this.props.username && this.props.username.charAt(0).toUpperCase() }\n        </div>\n      </div>\n    )\n  }\n\n}","import React, { Component } from 'react';\n\nexport default class HeaderIcon extends Component {\n\n  render() {\n    return (\n      <div\n        className={`header-icon ${this.props.className}`}\n        onClick={this.props.onClick}>\n        {(this.props.link) ? \n          <a href={this.props.link} className=\"icon inner\">\n            {this.props.icon}\n          </a> :\n\n          <span className=\"icon inner\">\n            {this.props.icon}\n          </span>\n        }\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nconst VIEW_LABELS = {\n  MY_DOCUMENTS: 'My Documents',\n  SHARED_WITH_ME: 'Shared with me'\n}\n\nexport default class Breadcrumbs extends Component {\n\n  render() {\n    const label = (this.props.view) ? VIEW_LABELS[this.props.view] : this.props.label;\n    return (\n      <div className=\"breadcrumbs\">\n        <h2>{label}</h2>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport axios from 'axios';\n\nimport Avatar from './Avatar.jsx';\n\nexport default class CollaboratorList extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = { collaborators: [] };\n    this.fetchCollaborators(props);\n  }\n\n  componentWillReceiveProps(props) {\n    this.fetchCollaborators(props);\n  }\n\n  fetchCollaborators(props) {\n    if (props.username)\n      axios\n        .get(`/api/account/${props.username}/collaborators`)\n        .then(result => this.setState({ collaborators: result.data }));\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        {this.state.collaborators.length > 0 &&\n          <div className={this.props.className ? `collaborator-list ${this.props.className}` : 'collaborator-list'}>\n            <h2>{this.props.title}</h2>\n            <ul>\n              {this.state.collaborators.map(user => \n                <li key={user.username}>\n                  <a href={`/${user.username}`} title={user.username}>\n                    <Avatar username={user.username} />\n                  </a>\n                </li>\n              )}\n            </ul>\n          </div>\n        }\n      </React.Fragment>\n    )\n  }\n\n}","import React, { Component } from 'react';\n\nimport Avatar from './Avatar.jsx';\n\nexport default class Identity extends Component {\n\n  formatURL(url) {\n    return url.replace(/^https?:\\/\\//i, '');\n  }\n\n  render() {\n    const dataAvailable = \n      this.props.account && \n      this.props.account.username &&\n      this.props.account.member_since;\n      \n    return (\n      <div className=\"identity\">\n        <div className=\"user\">\n          <Avatar username={dataAvailable && this.props.account.username} />\n\n          <h1>\n            { dataAvailable ?\n                ((this.props.account.real_name) ? \n                  this.props.account.real_name : this.props.account.username) :\n\n                (<span className=\"placeholder\" />) }\n          </h1>\n\n          <p className=\"member-since\">\n            { dataAvailable ?\n              <React.Fragment>\n                Joined on { new Intl.DateTimeFormat('en-GB', {\n                  year : 'numeric',\n                  month: 'short',\n                  day  : '2-digit'\n                }).format(new Date(this.props.account.member_since)) }\n              </React.Fragment> : <span className=\"placeholder\" />\n            }\n          </p>\n        </div>\n\n        <div className=\"user-extended\">\n          { dataAvailable && this.props.account.bio &&\n            <p className=\"bio\">{this.props.account.bio}</p> }\n\n          { dataAvailable && this.props.account.website && \n            <p className=\"homepage\">\n              <a href={this.props.account.website}>{this.formatURL(this.props.account.website)}</a>\n            </p>\n          }\n        </div>\n      </div>\n    )\n  }\n\n}\n","import { Component } from 'react';\n\nimport { Columns } from '../Columns.js';\n\nexport default class BaseRowComponent extends Component {\n\n  constructor(props) {\n    super(props);\n    this.updateTotalRowSpan(props);\n  }\n\n  componentWillReceiveProps(next) {\n    this.updateTotalRowSpan(next);\n  }\n\n  /** Updates total unit width requirement for current row layout **/\n  updateTotalRowSpan(props) {\n    this._totalSpan = props.columns.reduce((total, field) => total + Columns.getSpan(field), 0);\n  }\n\n  getWidth(field) {\n    const span = Columns.getSpan(field);\n    return span / this._totalSpan;\n  }\n  \n}","import React from 'react';\n\nimport BaseRowComponent from './BaseRowComponent.jsx';\nimport { HEADER_NAMES } from '../Columns.js';\n\nexport default class HeaderRow extends BaseRowComponent {\n\n  render() {\n    return (\n      <div className=\"column-labels\">\n        {this.props.columns.map(field =>\n          <span\n            key={field}\n            style={{ width: `${100 * super.getWidth(field)}%` }}\n            className={`label ${field}`}\n            onClick={this.props.onSort.bind(this, field)}>\n            <span className=\"inner-wrapper\">\n              <span className=\"inner\">\n                {HEADER_NAMES[field] || field}\n              </span>\n              {this.props.sortColumn === field &&\n                <span className=\"sort icon\">\n                  <span className=\"inner\">\n                    {(this.props.sortAsc) ? '\\ue688' : '\\ue682' }\n                  </span>\n                </span>\n              }\n            </span>\n          </span>\n        )}\n      </div>\n    )\n  }\n\n}\n","import React from 'react';\nimport NumberFormat from 'react-number-format';\nimport TimeAgo from 'react-timeago';\n\nimport BaseRowComponent from './BaseRowComponent.jsx';\n\n/** Icons for possible content type values **/\nconst ICONS = {\n  TEXT_PLAIN   : 'icon_text.png',\n  TEXT_TEIXML  : 'icon_tei.png',\n  IMAGE_UPLOAD : 'icon_image.png',\n  IMAGE_IIIF   : 'icon_iiif.png',\n  DATA_CSV     : 'icon_csv.png'\n};\n\n/** Formatting rules for possible field types **/\nconst FORMATTERS = {\n  language: (language) => \n    language.toUpperCase(),\n\n  uploaded_at: (datetime) => \n    new Intl.DateTimeFormat('en-GB', {\n      year : 'numeric',\n      month: 'short',\n      day  : '2-digit'\n    }).format(new Date(datetime)),\n  \n  last_edit_at: (datetime) => \n    <TimeAgo date={datetime} />,\n\n  public_visibility: (visibility) => {\n    if (visibility === 'PUBLIC') \n      return ( <span className=\"icon\" title=\"Open to anyone\">&#xf09c;</span> );\n    else if (visibility === 'WITH_LINK')\n      return ( <span className=\"icon\" title=\"Open to anyone with the link\">&#xf0c1;</span> );\n    else \n      return ( <span className=\"icon\" title=\"Private\">&#xf023;</span> );\n  },\n\n  annotations: (annotations) =>\n    <NumberFormat \n      displayType=\"text\"\n      value={annotations}\n      thousandSeparator={true} />\n\n};\n\n/** Rules for aggregate fields **/\nconst AGGREGATE_FIELDS = {\n  agg_document: (item) => (item.author) ?\n                            `${item.author}, ${item.title}` : item.title\n};\n\nexport default class DocumentRow extends BaseRowComponent {\n\n  createAggregateField(url, field) {\n    return (\n      <a \n        key={field}\n        href={url} \n        className={field.substring(4)}\n        style={{ width: `${100 * super.getWidth(field)}%` }}>\n\n        {AGGREGATE_FIELDS[field](this.props.item)}\n      </a>\n    )\n  }\n\n  createField(url, field) {\n    const formatter = FORMATTERS[field];\n\n    const value = this.props.item[field] !== undefined ? \n      (formatter ? formatter(this.props.item[field]) : this.props.item[field]) :\n      ''; // empty value\n\n    return (\n      <a \n        key={field}\n        href={url}\n        className={field}\n        style={{ width: `${100 * super.getWidth(field)}%` }}>{value}</a>\n    )\n  }\n\n  render() {\n    const type = this.props.item.filetypes[0];\n    const url = `document/${this.props.item.id}/part/1/edit`;\n\n    return (\n      <div\n        className={`row${(this.props.selected) ? ' selected' : ''}`}\n        style={this.props.style}\n        onClick={this.props.onClick} >\n        \n        { this.props.columns.map(field => field.startsWith('agg_') ? \n          this.createAggregateField(url, field) : this.createField(url, field)) }\n\n        <span className={`type icon ${type}`}>\n          <img src={`/assets/images/${ICONS[type]}`} alt={`icon type ${type}`} />\n        </span>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nexport default class FolderRow extends Component {\n\n  render() {\n    return (\n      <div\n        style={this.props.style}\n        className=\"row folder\">\n        <a href=\"#\" className=\"folder-icon\">&#xf07b;</a>\n        <a href=\"#\" className=\"folder-name\">{this.props.name}</a>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport Draggable from 'react-draggable';\n\nexport default class Modal extends Component {\n\n  render() {\n    return (\n      <div className={`clicktrap ${this.props.className}`}>\n        <div className=\"modal-wrapper\">\n          <Draggable handle=\".modal-header\">\n            <div className=\"modal\">\n              <div className=\"modal-header\">\n                <h1 className=\"title\">{this.props.title}</h1>\n                <button\n                  className=\"close nostyle\"\n                  onClick={this.props.onClose}>&#xe897;</button>\n              </div>\n\n              <div className=\"modal-body\">\n                {this.props.children}\n              </div>\n            </div>\n          </Draggable>\n        </div>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { SortableContainer, SortableElement } from 'react-sortable-hoc';\n\nimport { HEADER_NAMES } from '../Columns.js';\n\nconst SortableItem = SortableElement(({ label }) =>\n  <div className=\"card\">{label}</div>\n);\n\nconst SortableList = SortableContainer(({ items }) =>\n  <div className=\"column-order\">\n    {items.map((item, idx) => (\n      <SortableItem key={`card-${idx}`} index={idx} label={HEADER_NAMES[item]} />\n    ))}\n  </div>\n);\n\nexport default class ColumnOrder extends Component {\n\n  render() {\n    return (\n      <SortableList\n        items={this.props.items}\n        onSortEnd={e => this.props.onSortEnd(e.oldIndex, e.newIndex)} />\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { arrayMove } from 'react-sortable-hoc';\n\nimport Modal from '../../../components/Modal.jsx';\nimport ColumnOrder from './ColumnOrder.jsx';\n\nimport { COLUMNS, HEADER_NAMES } from '../Columns.js';\n\nexport default class PreferencesModal extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      columns: props.columns.slice(0)\n    }\n  }\n\n  componentWillReceiveProps(next) {\n    if (next.columns !== this.props.columns)\n      this.setState({ columns: next.columns.slice(0) });\n  }\n\n  /** Computes a map (fieldname -> checked) from the current columns state **/\n  getCheckboxStates(props) {\n    const states = {};\n\n    COLUMNS.forEach(field => {\n      const isChecked = this.state.columns.includes(field);\n      states[field] = isChecked;\n    });\n\n    return states;\n  }\n\n  /** Sets visibility for all rows to the given boolean value **/\n  setAllRows(checked) {\n    const checkAll = () => {\n      const toAppend = \n        COLUMNS.filter(field => !this.state.columns.includes(field));\n\n      this.setState({ columns: this.state.columns.concat(toAppend) });\n    };\n\n    const uncheckAll = () => {\n      this.setState({ columns: [] });\n    };\n\n    if (checked) \n      checkAll();\n    else\n      uncheckAll();\n  }\n\n  /**\n   * Clicking 'ALL' either checks all boxes or - if all are currently\n   * checked, unchecks them.\n   */\n  onClickAll() {\n    const allRowsChecked = COLUMNS.length === this.state.columns.length;\n    if (allRowsChecked)\n      this.setAllRows(false);\n    else\n      this.setAllRows(true);\n  }\n\n  /** Toggles the checkbox with the given name **/\n  toggleOne(name) {\n    this.setState(prev => {\n      const idx = prev.columns.indexOf(name);\n      if (idx < 0)\n        prev.columns.push(name);\n      else\n        prev.columns.splice(idx, 1);        \n    \n      return prev;\n    });\n  }\n\n  onSort(oldIndex, newIndex) {\n    this.setState({\n      columns: arrayMove(this.state.columns, oldIndex, newIndex)\n    });\n  }\n\n  render() {\n    // Helper to create a single checkbox + label row\n    const createRow = (field) =>\n      <li key={field}>\n        <input\n          type=\"checkbox\"\n          id={field}\n          name={field}\n          checked={this.state.columns.includes(field)}\n          onChange={this.toggleOne.bind(this, field)} />\n        <label htmlFor={field}>{HEADER_NAMES[field]}</label>\n      </li>\n\n    return (\n      <Modal\n        className=\"preferences\"\n        title=\"Configure Columns\"\n        onClose={this.props.onCancel}>\n\n        <div className=\"scroll-pane\">\n          <div className=\"selected-columns\">\n            <button\n              className=\"all nostyle\"\n              onClick={this.onClickAll.bind(this)}>All</button>\n            <ul>\n              { COLUMNS.map(createRow) }\n            </ul>\n          </div>\n\n          <ColumnOrder\n            items={this.state.columns} \n            onSortEnd={this.onSort.bind(this)} />\n        </div>\n\n        <div className=\"buttons\">\n          <button\n            className=\"btn\"\n            onClick={this.props.onSave.bind(this, this.state.columns)}>Save</button>\n\n          <button \n            className=\"btn outline\"\n            onClick={this.props.onCancel}>Cancel</button>\n        </div>\n      </Modal>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport { AutoSizer, List } from 'react-virtualized';\nimport Dropzone from 'react-dropzone'\n\nimport DropzoneDecoration from '../upload/DropzoneDecoration.jsx';\nimport Readme from '../Readme.jsx';\nimport Selection from '../Selection.js';\n\nimport HeaderRow from './rows/HeaderRow.jsx';\nimport DocumentRow from './rows/DocumentRow.jsx';\nimport FolderRow from './rows/FolderRow.jsx';\nimport PreferencesModal from  './preferences/PreferencesModal.jsx';\n\nexport default class TablePane extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      prefsOpen: false,\n      selection: new Selection(props.folders.concat(props.documents), props.selection)\n    }\n  }\n\n  /** Set derived state **/\n  componentWillReceiveProps(next) {\n    this.setState({ \n      selection: new Selection(next.folders.concat(next.documents), next.selection)\n    });\n  }\n\n  /** Handle click/SHIFT+click/CTRL+click selection via Selection helper class */\n  onClick(evt, item, idx) {\n    const isShift = evt.getModifierState(\"Shift\");\n    const isCtrl = evt.getModifierState(\"Control\");\n\n    // Is this a selection or deselection?\n    const isSelectAction = \n      isShift || isCtrl || !this.props.selection.includes(item);\n\n    if (isSelectAction) {\n      if (isShift)\n        this.state.selection.selectRange(idx);\n      else\n        this.state.selection.selectItem(item, isCtrl);\n\n      this.props.onSelect(this.state.selection.getSelectedItems());\n      evt.preventDefault();\n    }\n  }\n\n  rowRenderer() {\n    const allItems = this.props.folders.concat(this.props.documents);\n\n    return ((args) => {\n      const item = allItems[args.index];\n      const isFolder = item.name;\n\n      if (isFolder)\n        return (\n          <FolderRow key={args.key} style={args.style} name={item.name} />\n        )\n      else\n        return (\n          <DocumentRow\n            key={args.key}\n            style={args.style}\n            columns={this.props.columns}\n            item={item}\n            selected={this.props.selection && this.props.selection.includes(item)}\n            onClick={e => this.onClick(e, item, args.index)} />\n        )\n    })\n  }\n\n  showPreferences(visible) {\n    this.setState({ prefsOpen: visible });\n  }\n\n  onSavePreferences(columns) {\n    this.setState({ prefsOpen: false });\n    this.props.onChangeColumnPrefs(columns);\n  }\n\n  sortBy(field) {\n    const asc = this.props.sorting ?\n      this.props.sorting.by === field ? !this.props.sorting.asc : true :\n      true;\n\n    this.props.onSort({ by: field, asc: asc });\n  }\n\n  onDrag(active) {\n    this.setState({ drag: active });\n  }\n\n  onDrop(files, _, evt) {\n    const url = evt.dataTransfer.getData('URL');\n\n    const hostname = url ? (() => {\n      const a = document.createElement('a');\n      a.href = url;\n      return a.hostname;\n    })() : null;\n\n    this.setState({ drag: false });\n\n    if (files.length > 0)\n      this.props.onDropFiles(files);\n    else if (url && hostname !== window.location.hostname) // Require external link\n      this.props.onDropURL(url);\n  }\n\n  render() {\n    const readme = React.Children.toArray(this.props.children)\n      .filter(c => c.type === Readme)\n      .shift(); // First readme or undefined\n\n    const tablePane =\n      <div className=\"documents-pane table-pane\">\n        <AutoSizer>\n          {({ height, width }) => (\n            <List\n              className=\"virtualized-list\"\n              width={width}\n              height={height}\n              rowCount={this.props.folders.length + this.props.documents.length}\n              rowHeight={47}\n              rowRenderer={this.rowRenderer()} />\n          )}\n        </AutoSizer>\n\n        { this.state.drag && <DropzoneDecoration /> }\n        { this.props.busy && <div className=\"busy-mask\" /> }\n      </div>\n\n    return (\n      <React.Fragment>\n        <div className=\"documents-table-header\">\n          <HeaderRow \n            columns={this.props.columns} \n            onSort={this.sortBy.bind(this)}\n            sortColumn={this.props.sorting ? this.props.sorting.by : null} \n            sortAsc={this.props.sorting ? this.props.sorting.asc : null} />\n\n          <button\n            className=\"column-options-btn nostyle icon\"\n            onClick={this.showPreferences.bind(this, true)} >&#xf141;</button>\n        </div>\n\n        {readme}\n\n        {this.props.disableFiledrop ? tablePane :\n          <Dropzone\n            className=\"dropzone\"\n            disableClick={true}\n            onDragEnter={this.onDrag.bind(this, true)}\n            onDragLeave={this.onDrag.bind(this, false)}\n            onDrop={this.onDrop.bind(this)}>\n            \n            {tablePane}\n            \n          </Dropzone>\n        }\n\n        {this.state.prefsOpen &&\n          <PreferencesModal\n            columns={this.props.columns}\n            onCancel={this.showPreferences.bind(this, false)} \n            onSave={this.onSavePreferences.bind(this)} />\n        }\n      </React.Fragment>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nexport default class Folder extends Component {\n\n  render() {\n    return (\n      <div className=\"cell\">\n        <div className=\"item-wrapper\">\n          <a href=\"#\" className=\"folder\">\n            <div className=\"label\">\n              {this.props.name}\n            </div>\n          </a>\n        </div>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\n\nexport default class Document extends Component {\n\n  render() {\n    const type = this.props.filetypes[0]; // TODO make more clever in the future\n    const isStacked = this.props.fileCount > 1;\n\n    return (\n      <div\n        className={`cell${(this.props.selected) ? ' selected' : ''}`}\n        onClick={this.props.onClick}\n        onDoubleClick={this.props.onDoubleClick} >\n        \n        <div className=\"inner\">\n          <div className={`item-wrapper${isStacked ? ' stacked' : ''}`}>\n            { isStacked && <div className=\"stack\" /> }\n            <a href={`document/${this.props.id}/part/1/edit`} className={`document ${type}`}>\n              <div className=\"label\">\n                {this.props.title}\n              </div>\n            </a>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n}\n","import React, { Component } from 'react';\nimport Dropzone from 'react-dropzone'\n\nimport { AutoSizer, List } from 'react-virtualized';\n\nimport Selection from '../Selection.js';\nimport Folder from './Folder.jsx';\nimport Document from './Document.jsx';\nimport Readme from '../Readme.jsx';\n\nimport DropzoneDecoration from '../upload/DropzoneDecoration.jsx';\n\nconst ITEM_SIZE = 192;\n\n/**\n * Using the following example:\n *\n * https://stackoverflow.com/questions/46368305/how-to-make-a-list-grid-with-a-responsive-number-of-columns-using-react-virtuali\n * http://plnkr.co/edit/zjCwNeRZ7XtmFp1PDBsc?p=preview\n */\nexport default class GridPane extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      selection: new Selection(props.folders.concat(props.documents), props.selection) \n    };\n  }\n\n  /** Set derived state **/\n  componentWillReceiveProps(next) {\n    this.setState({ \n      selection: new Selection(next.folders.concat(next.documents), next.selection)\n    });\n  }\n\n  /** Handle click/SHIFT+click/CTRL+click selection via Selection helper class */\n  onClick(evt, item, idx) {\n    const isShift = evt.getModifierState(\"Shift\");\n    const isCtrl = evt.getModifierState(\"Control\");\n\n    if (isShift)\n      this.state.selection.selectRange(idx);\n    else\n      this.state.selection.selectItem(item, isCtrl);\n\n    this.props.onSelect(this.state.selection.getSelectedItems());\n    evt.preventDefault();\n  }\n\n  onDoubleClick(item) {\n    window.location.href= `document/${item.id}/part/1/edit`;\n  }\n\n  rowRenderer(itemsPerRow, rowCount) {\n    const allItems = this.props.folders.concat(this.props.documents);\n\n    return ((args) => {\n      const fromIndex = args.index * itemsPerRow;\n      const toIndex = Math.min(fromIndex + itemsPerRow, allItems.length);\n      const itemsInRow = toIndex - fromIndex;\n\n      const renderedItems = new Array(itemsInRow).fill(undefined).map((_, rowIdx) => {\n        const idx = rowIdx + fromIndex;\n        const item = allItems[idx];\n\n        const isFolder = item.name; // Dummy condition\n        if (isFolder)\n          return (\n            <Folder key={idx} name={item.name} />\n          )\n        else\n          return (\n            <Document\n              key={idx}\n              id={item.id}\n              title={item.title}\n              filetypes={item.filetypes}\n              fileCount={item.file_count}\n              selected={this.props.selection && this.props.selection.includes(item)}\n              onClick={e => this.onClick(e, item, args.index)} \n              onDoubleClick={this.onDoubleClick.bind(this, item)} />\n          )\n      });\n\n      if (itemsInRow < itemsPerRow) // Add dummies to preserve grid layout\n        renderedItems.push(new Array(itemsPerRow - itemsInRow).fill(undefined).map((_, idx) =>\n          <div className=\"cell dummy\" key={`dummy-${idx}`} />\n        ))\n\n      return (\n        <div\n          key={args.key}\n          style={args.style}\n          className=\"row\">\n          {renderedItems}\n        </div>\n      )\n    });\n  }\n\n  onDrag(active) {\n    this.setState({ drag: active });\n  }\n\n  onDrop(files, _, evt) {\n    const url = evt.dataTransfer.getData('URL');\n\n    this.setState({ drag: false });\n\n    if (files.length > 0) this.props.onDropFiles(files);\n    else if (url) this.props.onDropURL(url);\n  }\n\n  render() {\n    const readme = React.Children.toArray(this.props.children)\n      .filter(c => c.type === Readme)\n      .shift(); // First readme or undefined\n\n    const gridPane =\n      <AutoSizer>\n        {({ height, width }) => {\n          const itemCount = this.props.folders.length + this.props.documents.length;\n          const itemsPerRow = Math.floor(width / ITEM_SIZE);\n          const rowCount = Math.ceil(itemCount / itemsPerRow);\n\n          return (\n            <List\n              className=\"virtualized-grid\"\n              width={width}\n              height={height}\n              rowCount={rowCount}\n              rowHeight={ITEM_SIZE}\n              rowRenderer={this.rowRenderer(itemsPerRow, rowCount)} />\n          )\n        }}\n      </AutoSizer>\n\n    return (\n      <React.Fragment>\n        {readme}\n        <div className=\"documents-pane grid-pane\">\n          {this.props.disableFiledrop ? gridPane :\n            <Dropzone\n              className=\"dropzone\"\n              disableClick={true}\n              onDragEnter={this.onDrag.bind(this, true)}\n              onDragLeave={this.onDrag.bind(this, false)}\n              onDrop={this.onDrop.bind(this)}>\n\n              {gridPane}\n\n            </Dropzone>\n          }\n\n          { this.state.drag && <DropzoneDecoration /> }\n        </div>\n      </React.Fragment>\n    )\n  }\n\n}\n"],"sourceRoot":""}